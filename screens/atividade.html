<div class="page" data-screen-title="Portf√≥lio">
  <div class="dashboard-header">
    <p class="subtitle">Todos os ativos em carteira</p>
  </div>

  <!-- üß≠ KPIs -->
  <div class="portfolio-summary">
    <div class="card premium">
      <div class="card-content">
        <div>
          <p class="label">Valor Total Investido</p>
          <p class="value" id="prtTotalInvestido">‚Ç¨0,00</p>
        </div>
        <div class="icon-box"><i class="fas fa-coins"></i></div>
      </div>
    </div>

    <div class="card success">
      <div class="card-content">
        <div>
          <p class="label">Dividendos anuais esperado</p>
          <p class="value" id="prtRendimentoAnual">‚Ç¨0,00</p>
        </div>
        <div class="icon-box"><i class="fas fa-wallet"></i></div>
      </div>
    </div>

    <div class="card info">
      <div class="card-content">
        <div>
          <p class="label">Retorno global (P/L%)</p>
          <p class="value" id="prtRetorno">0%</p>
        </div>
        <div class="icon-box"><i class="fas fa-chart-line"></i></div>
      </div>
    </div>

    <div class="card default">
      <div class="card-content">
        <div>
          <p class="label">Exposi√ß√£o acima da SMA200</p>
          <p class="value" id="prtExpSMA200">0%</p>
        </div>
        <div class="icon-box"><i class="fas fa-trending-up"></i></div>
      </div>
    </div>
  </div>

  <!-- üìà GR√ÅFICOS (linha 1: Setores + Mercado) -->
  <div class="portfolio-charts">
    <div class="card">
      <h3>Distribui√ß√£o por Setores</h3>
      <div class="chart-wrap"><canvas id="chartSetores"></canvas></div>
    </div>

    <div class="card">
      <h3>Distribui√ß√£o por Mercado</h3>
      <div class="chart-wrap"><canvas id="chartMercados"></canvas></div>
    </div>
  </div>

  <!-- üìà GR√ÅFICOS (linha 2: Top5 Investido + Top5 Yield) -->
  <div class="portfolio-charts">
    <div class="card">
      <h3>Top 5 por Valor Investido</h3>
      <div class="chart-wrap"><canvas id="chartTop5"></canvas></div>
    </div>

    <div class="card">
      <h3>Top 5 por Yield</h3>
      <div class="chart-wrap"><canvas id="chartTop5Yield"></canvas></div>
    </div>
  </div>

  <!-- üìà GR√ÅFICOS (linha 3: Timeline + Calend√°rio Dividendos) -->
  <div class="portfolio-charts">
    <div class="card">
      <h3>Evolu√ß√£o (Investido vs Avalia√ß√£o Atual)</h3>
      <div class="chart-wrap"><canvas id="chartTimeline"></canvas></div>
    </div>

    <div class="card">
      <h3>Calend√°rio de Dividendos (12 meses)</h3>
      <div class="chart-wrap"><canvas id="chartDivCalendario"></canvas></div>
    </div>
  </div>

  <!-- üîé LISTA -->
  <div id="listaAtividades"></div>
</div>

<!-- ======== Estilos locais (collapse + modal simples) ======== -->
<style>
  .activity-item.collapsed .activity-details { display: none; }
  .collapse-btn { border:none; background:transparent; cursor:pointer; font-size:18px; margin-right:8px; }

  .modal.hidden{display:none}
  .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.4);z-index:9999}

</style>

<!-- ======== Modal r√°pido para Comprar/Vender e Editar ======== -->
<div id="pfAddModal" class="modal hidden">
  <div class="modal-dialog">
    <div class="modal-header">
      <h3 id="pfAddTitle">Registar</h3>
      <button id="pfAddClose" class="btn">Fechar</button>
    </div>
    <form id="pfAddForm">
      <div class="modal-body">
        <input type="hidden" id="pfDocId" />
        <input type="hidden" id="pfTipoAcao" value="compra" />

        <label>Nome</label>
        <input id="pfNome" type="text" />

        <label>Ticker</label>
        <input id="pfTicker" type="text" />

        <label>Setor</label>
        <input id="pfSetor" type="text" />

        <label>Mercado</label>
        <input id="pfMercado" type="text" />

        <label id="pfLabelPreco">Pre√ßo de compra (‚Ç¨)</label>
        <input id="pfPreco" type="number" step="0.0001" />

        <label>Quantidade</label>
        <input id="pfQuantidade" type="number" step="0.0001" />

        <label>Objetivo (lucro ‚Ç¨)</label>
        <input id="pfObjetivo" type="number" step="0.01" />

        <div id="pfVendaTotalWrap" style="display:none; margin-top:8px">
          <label style="display:flex; gap:.5rem; align-items:center">
            <input id="pfVendaTotal" type="checkbox" />
            Vender posi√ß√£o total (apaga movimentos anteriores)
          </label>
        </div>
      </div>
      <div class="modal-actions">
        <button type="button" id="pfAddCancel" class="btn">Cancelar</button>
        <button type="submit" id="pfAddSave" class="btn primary">Guardar</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal QUICK BUY/SELL (mant√©m o teu modal existente) -->
<!-- ... o teu #pfAddModal aqui, sem altera√ß√µes ... -->
<!-- üìò Ajuda das M√©tricas -->
<div id="prtHelpModal" class="modal hidden">
  <!-- nota: acrescentei a classe prt-help-dialog -->
  <div class="modal-dialog prt-help-dialog">
    <div class="modal-header">
      <h3>Como ler este ecr√£</h3>
      <button class="icon-btn" id="prtHelpClose" title="Fechar">‚úñ</button>
    </div>

    <!-- corpo rol√°vel -->
    <div class="help-body">
      <div class="page" style="padding:14px">
        <div class="muted" style="display:grid; gap:.6rem; line-height:1.4">
          <div><strong>Valor Total Investido</strong> ‚Äî soma de todo o capital investido nas posi√ß√µes ativas.</div>
          <div><strong>Rendimento anual esperado</strong> ‚Äî estimativa: Œ£(qtd √ó dividendo √ó pagamentos/ano) por ativo, de acordo com a periodicidade.</div>
          <div><strong>Retorno global (P/L%)</strong> ‚Äî (Avalia√ß√£o atual ‚àí Investido) / Investido.</div>
          <div><strong>Exposi√ß√£o acima da SMA200</strong> ‚Äî percentagem do portef√≥lio (ponderada pelo investidor) com pre√ßo acima da m√©dia m√≥vel 200.</div>

          <hr>

          <div><strong>Distribui√ß√£o por Setores / Mercado</strong> ‚Äî donuts com o peso investido por categoria.</div>
          <div><strong>Top 5 por Investido</strong> ‚Äî barras com as maiores posi√ß√µes (investido e lucro atual).</div>
          <div><strong>Top 5 por Yield</strong> ‚Äî barras horizontais ordenadas por dividend yield atual.</div>
          <div><strong>Evolu√ß√£o</strong> ‚Äî linha ‚ÄúInvestido acumulado‚Äù vs ‚ÄúAvalia√ß√£o atual‚Äù.</div>
          <div><strong>Calend√°rio de Dividendos (12m)</strong> ‚Äî soma estimada de ‚Ç¨ por m√™s, com base no m√™s t√≠pico e periodicidade.</div>

          <hr>

          <div><strong>Badges por ativo</strong>:
            <ul style="margin:.3rem 0 0 1.1rem">
              <li><em>Yield</em> (dividendo/valorStock) e <em>Yield 24m</em> (m√©dia 24m) ‚Üí indica se est√° ‚Üë acima ou ‚Üì abaixo da m√©dia.</li>
              <li><em>P/E</em> (faixas: &lt;15 barato, 15‚Äì25 justo, &gt;25 caro).</li>
              <li><em>Œî50d / Œî200d</em> ‚Äî varia√ß√£o vs. SMA 50/200.</li>
              <li><em>Sem√°foro</em> ‚Äî tend√™ncia r√°pida (üü¢/üü°/üî¥) com base em SMA200 e crescimento de 1 m√™s.</li>
              <li><em>TP2 &amp; ETA</em> ‚Äî pre√ßo alvo e estimativa de tempo para l√° chegar (usando a melhor taxa dispon√≠vel).</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- a√ß√µes fixas em baixo -->
    <div class="actions-row help-actions" style="justify-content:space-between">
      <label class="muted" style="display:flex; align-items:center; gap:.5rem">
        <input type="checkbox" id="prtHelpDontShow">
        N√£o mostrar novamente neste dispositivo
      </label>

      <div>
        <button class="btn outline" id="prtHelpLater">Fechar</button>
        <button class="btn premium" id="prtHelpOK">Percebi</button>
      </div>
    </div>
  </div>
</div>
